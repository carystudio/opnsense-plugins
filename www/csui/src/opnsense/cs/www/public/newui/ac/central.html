<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Carystudio</title>
    <link rel="stylesheet" href="/newui/plugin/iview/styles/iview.css">
    <link rel="stylesheet" href="/newui/static/css/style.css">
</head>
<body>
<div id="app"></div>

<script type="text/x-template" id="main">
    <Col class="cs-container" span="20" >
    <slot name="breadcrumb" :breadcrumb="[$t('menu.ac'),$t('menu.central')]"></slot>
    <!-- 这个不能删除，用于面包屑显示 -->
    <div class="cs-content">
        <Row>
            <Col :xs="globalConfig.xs">
            <Card>
                <Alert>
                    {{ $t('central.help') }}
                </Alert>
                <Row>
                    <Col>
                    <Button type="primary" :loading="apscanLoading" @click="apscanClick">{{ $t('central.apscan') }}</Button>
                    <Button type="primary" @click="setinfoClick">{{ $t('central.setinfo') }}</Button>
                    <Button type="primary" @click="letctlClick">{{ $t('central.letctl') }}</Button>
                    <Button type="primary" @click="timingRebootClick(true)">{{ $t('central.unified_change_ip') }}</Button>
                    <Button type="primary" @click="rebootClick">{{ $t('central.reboot') }}</Button>
                    <Button type="primary" @click="showModel=true">{{ $t('central.restore') }}</Button>
                    <Tooltip trigger="hover" placement="top" :disabled="!usbState">
                        <Button type="primary" @click="uploadClick" >{{ $t('central.firmware_manage') }}</Button>
                        <div slot="content" style="white-space: normal;"> {{ $t('central.firmware_manage') }} </div>
                    </Tooltip>
                    <Button type="primary" @click="firmwareClick">{{ $t('central.firmware') }}</Button>
                    </Col>
                    <br>
                    <Row>
                        <Col>
                        <Table border ref="tableSelect" :columns="centralColumns" :data="centralData" @on-selection-change="centralTable" :no-data-text="$t('common.no_data')"></Table>
                        </Col>
                    </Row>
                </Row>
            </Card>
            </Col>
        </Row>
    </div>
    <Modal
            v-model="showModel"
            :title="$t('central.restore_set_title')"
            @on-ok="ok"
            @on-cancel="cancel"
            :ok-text="$t('common.ok')"
            :cancel-text="$t('common.cancel')"
            >
        <span>{{$t('central.msg20')}}</span>
    </Modal>
    <Modal
            v-model="setinfo"
            :title="$t('central.setinfo')"
            :closable="false"
            :mask-closable="false"
    >
        <Form ref="formSetinfo" :model="formSetinfo" :label-width="120" :rules="ruleSetinfo" label-position="left">
            <FormItem :label="$t('central.apname')" prop="apname" v-if="multipleHide">
                <Input v-model="formSetinfo.apname" ></Input>
            </FormItem>
            <!--<FormItem :label="$t('central.authpwd')" prop="authpwd">-->
            <!--<Input v-model="formSetinfo.authpwd"></Input>-->
            <!--</FormItem>-->
            <!--<FormItem :label="$t('central.change_passwd')">-->
            <!--<Input v-model="formSetinfo.changePasswd" ></Input>-->
            <!--</FormItem>-->
            <!--<FormItem :label="$t('central.ipaddr')" prop="ipaddr" v-if="multipleHide">-->
            <!--<Input v-model="formSetinfo.ipaddr" ></Input>-->
            <!--</FormItem>-->
            <!--<FormItem :label="$t('central.default_gateway')" prop="gateway">-->
            <!--<Input v-model="formSetinfo.gateway" ></Input>-->
            <!--</FormItem>-->
            <!--<FormItem label="DNS" prop="dns">-->
            <!--<Input v-model="formSetinfo.dns" ></Input>-->
            <!--</FormItem>-->
            <FormItem :label="$t('central.ssid',[''])" prop="ssid2">
                <Input v-model="formSetinfo.ssid2" ></Input>
            </FormItem>
            <FormItem :label="$t('central.security',[''])" >
                <i-switch v-model="securityMode2" size="large" >
                    <span slot="open">{{$t('central.encryption')}}</span>
                    <span slot="close">{{$t('central.unencrypted')}}</span>
                </i-switch>
                <!--<Select v-model="formSetinfo.securityMode2" slot="prepend" style="width: 80px">-->
                    <!--<Option value="0">{{ $t('central.none_security') }}</Option>-->
                    <!--<Option value="1">{{ $t('central.security_psk') }}</Option>-->
                <!--</Select>-->
                </Input>
            </FormItem>
            <FormItem :label="$t('central.password')" prop="security2"  v-show="formSetinfo.securityMode2 == '1'" >
                <Input v-model="formSetinfo.security2"></Input>
            </FormItem>
            <FormItem :label="$t('central.broad_ssid')" prop="hidessid">
                <i-switch v-model="formSetinfo.hidessid" size="large" >
                    <span slot="open">{{ $t('central.enabled') }}</span>
                    <span slot="close">{{ $t('central.disable') }}</span>
                </i-switch>
            </FormItem>
            <FormItem :label="$t('central.isolation')" prop="wifi_quarantine">
                <i-switch v-model="formSetinfo.wifi_quarantine" size="large" >
                    <span slot="open">{{ $t('central.enabled') }}</span>
                    <span slot="close">{{ $t('central.disable') }}</span>
                </i-switch>
            </FormItem>
            <FormItem :label="$t('central.max_num')" prop="maxusernumber">
                <Input v-model="formSetinfo.maxusernumber"  style="width: 80px"></Input>
                <span>({{$t('central.default_value')}}: 32)</span>
            </FormItem>
            <FormItem :label="$t('central.vlan_mark')" prop="vlanid">
                <Input v-model="formSetinfo.vlanid"  style="width: 80px"></Input>
                <span> ({{$t('central.range')}} 0 - 4094,{{$t('central.default')}} 0)</span>
            </FormItem>
            <FormItem :label="$t('central.wlan_set')" prop="wlanset">
                <!--<div v-if="getWlanState">-->
                    <Select v-model="wlanset" :disabled="getWlanState">
                        <Option value="1">2.4G</Option>
                        <Option value="2">5G</Option>
                        <Option value="3">2.4G+5G</Option>
                    </Select>
                <!--</div>-->
                <!--<div v-else>-->
                    <!--<Select v-model="formSetinfo.wlanset">-->
                        <!--<Option value="1">2.4G</Option>-->
                        <!--<Option value="2">5G</Option>-->
                        <!--<Option value="3">2.4G+5G</Option>-->
                    <!--</Select>-->
                <!--</div>-->
            </FormItem>
            <div v-show="wlanset != '2'">
                <FormItem :label="$t('central.band2')" prop="band2">
                    <Select v-model="formSetinfo.band2">
                        <Option value="1">2.4 GHz (B)</Option>
                        <Option value="4">2.4 GHz (G)</Option>
                        <Option value="6">2.4 GHz (N)</Option>
                        <Option value="9">2.4 GHz (B+G+N)</Option>
                    </Select>
                </FormItem>
                <FormItem :label="$t('central.channels',['2.4G'])" prop="channel2">
                    <Select v-model="formSetinfo.channel2" :key="$t('central.channels',['2.4G'])">
                        <Option value="0">{{ $t('central.auto_select') }}</Option>
                        <Option v-for="i in 13" :key="i" :value="i">{{ i }}</Option>
                    </Select>
                </FormItem>
                <FormItem :label="$t('central.bandwidth2')" prop="band_width2">
                    <Select v-model="formSetinfo.band_width2">
                        <Option value="0">20M</Option>
                        <Option value="1">20M/40M</Option>
                    </Select>
                </FormItem>
                <FormItem :label="$t('central.tx_powers',['2.4G'])" prop="tx_power2">
                    <Select v-model="formSetinfo.tx_power2">
                        <Option v-for="i in txPower" :key="i" :value="i">{{ i+'%' }}</Option>
                    </Select>
                </FormItem>
                <FormItem v-show="false" :label="'2.4G ' + $t('central.beacon')" prop="beacon2g">
                    <Input v-model="formSetinfo.beacon2g"  style="width: 80px"></Input>
                    <span> ({{$t('central.range')}} 20 - 999,{{$t('central.default')}} 100)</span>
                </FormItem>
            </div>
            <div v-show="wlanset != '1'">
                <FormItem :label="$t('central.band5')" prop="band5">
                    <Select v-model="band5">
                        <Option value="2">802.11A</Option>
                        <Option value="8">802.11A/N</Option>
                        <Option value="14">802.11A/N/AC</Option>
                    </Select>
                </FormItem>
                <FormItem :label="$t('central.channels',['5G'])" prop="channel5">
                    <Select v-model="formSetinfo.channel5" :key="$t('central.channels',['5G'])">
                        <Option value="0">{{ $t('central.auto_select') }}</Option>
                        <Option v-for="i in channel5Arr" :key="i" :value="i">{{ i }}</Option>
                        <Option v-show="channelsStatus165" :key="165" value="165">165</Option>
                    </Select>
                </FormItem>
                <FormItem :label="$t('central.bandwidth5')" prop="band_width5">
                    <Select v-model="band_width5">
                        <Option value="0">20M</Option>
                        <Option value="1">20M/40M</Option>
                        <Option value="2">80M</Option>
                    </Select>
                </FormItem>

                <FormItem :label="$t('central.tx_powers',['5G'])" prop="tx_power5">
                    <Select v-model="formSetinfo.tx_power5">
                        <Option v-for="i in txPower" :key="i" :value="i">{{ i+'%'}}</Option>
                    </Select>
                </FormItem>
                <FormItem v-show="false" :label="'5G ' + $t('central.beacon')" prop="beacon5g">
                    <Input v-model="formSetinfo.beacon5g"  style="width: 80px"></Input>
                    <span> ({{$t('central.range')}} 20 - 999,{{$t('central.default')}} 100)</span>
                </FormItem>
            </div>
        </Form>
        <div slot="footer">
            <Button type="text" @click="setinfo=false">{{ $t('common.cancel') }}</Button>
            <Button type="primary" @click="setinfoOk">{{ $t('common.apply') }}</Button>
        </div>
    </Modal>
    <Modal
            v-model="letctl"
            :title="$t('central.letctl')"
    >
        <Alert>
            {{ $t('central.ledctl_tip') }}
        </Alert>
        <Form :label-width="120" label-position="left">
            <FormItem>
                <Button type="primary" @click="letctlOk(2)">{{ $t('central.open') }}</Button>
                <Button type="primary" @click="letctlOk(1)">{{ $t('central.finish') }}</Button>
            </FormItem>
        </Form>
        <div slot="footer">
        </div>
    </Modal>
    <Modal
            v-model="uploads"
            :title="$t('central.firmware_manage')"
    >
        <Form :label-width="120" label-position="left">
            <FormItem :label="$t('central.upload')">
                <!-- :max-size="upload.maxSize" -->
                <Upload
                        ref="upload"
                        :action="upload.action"
                        :data="upload.data"
                        :format="upload.format"
                        :on-format-error="formatError"
                        :before-upload="handleBeforeUpload"
                        :on-success="uploadSuccess"
                >
                    <Button icon="ios-cloud-upload-outline">{{ $t('central.select_file')+' & '+$t('central.file_upload')   }}</Button>
                </Upload>
            </FormItem>
            <br>
            <Row>
                <Col>
                <Table border :columns="columns" :data="firmData" :no-data-text="$t('common.no_data')"></Table>
                </Col>
            </Row>
            <br>
        </Form>
        <div slot="footer">
        </div>
    </Modal>
    <!-- 这个不能删除，用于底部显示 -->
    <slot name="footer"></slot>
    </Col>
</script>
<script src="/newui/plugin/vue.js"></script>
<script src="/newui/plugin/vue-i18n.js"></script>
<script src="/newui/plugin/iview/iview.js"></script>
<script src="/newui/plugin/jquery-1.11.3.min.js"></script>
<script src="/newui/plugin/util.js"></script>
<script src="/newui/static/js/language.js"></script>
<script src="/newui/static/js/config.js"></script>
<script src="/newui/static/js/layout.js"></script>
<script src="/newui/static/js/common.js"></script>
<script src="/newui/static/js/topicurl.js"></script>
<script>
    var cs_main = {
        template: "#main",
        data: function() {
            var _this = this;
            return {
                globalConfig: globalConfig,
                applyLoading: false,
                apscanLoading: false,
                multipleHide: true,
                centralData: [],
                usbState:true,
                setinfo:false,
                letctl:false,
                reboot: false,
                timingReboot: false,
                restore: false,
                uploads: false,
                firmware: false,
                txPower:['15','35','50','75','100'],
                selectData:[],
                apname:[],
                ledStateInfo:[],
                channel5Arr:['36','40','44','48','149','153','157','161'],

                ledStatus:false,
                wlanState:false,
                wlanset:'3',
                showModel:false,
                securityMode2:false,
                channelsStatus165:false,
                band_width5:'2',
                band5:'14',
                /*formSetinfo: {
                    apname: '',
                    ssid2: '',
                    authpwd: 'admin',
                    changePasswd: '',
                    ipaddr: '',
                    gateway: '',
                    dns: '',
                    country2g:"CN",
                    country5g:"CN",
                    security2: '',
                    securityMode2: '0',
                    hidessid:false,
                    wifi_quarantine:false,
                    maxusernumber:'32',
                    vlanid:'0',
                    wlanset:'3',
                    band2:'9',
                    channel2: '0',
                    band_width2:'0',
                    tx_power2: '100',
                    beacon2g:'100',
                    band5:'14',
//                    ssid5: '',
                    security5: '',
//                    securityMode5: '',
                    channel5: '0',
                    band_width5:'2',
                    tx_power5: '100',
                    beacon5g:'100',
                    other:[]
                },*/
                letctlAuthpwd:'admin',
                timingRebootSelect:'',
                upload: {
                    file: null,
                    action: '/webapi',
                    format:['web'],
                    data:{
                        action:'setUploadFile'
                    }
                },
                columns:[
                    {
                        type: 'index',
                        width: 40,
                        align: 'center'
                    },{
                        title: this.$t('central.firmware_version'),
                        key: 'version',
                        align: 'center'
                    },{
                        title: this.$t('central.operation'),
                        key: 'action',
                        width: 95,
                        align: 'center',
                        render: function (h, params) {
                        return h('div', [
                            h('Poptip', {
                                props: {
                                    confirm: true,
                                    title: _this.$t('central.msg18'),
                                    "ok-text":_this.$t('common.ok'),
                                    "cancel-text":_this.$t('common.cancel')
                                },
                                on: {
                                    "on-ok": function(){
                                        var postData = {"action":"delApUpgradeFile","data":{"version":params.row.version}};
                                        uiPost.delApUpgradeFile(postData,function(){
                                            _this.$Message.success({content:_this.$t('account.msg11'),onClose:function(){
                                                location.href = location.href;
                                            }});
                                        });
                                    }
                                }
                            },
                        [
                            h('Button', {
                                props: {
                                    type: 'error',
                                    size: 'small'
                                }
                            }, _this.$t('localaccount.delete'))
                        ])
                ]);
            }
            }
            ],
            firmData:[],
            percent: 0
            }
        },
        computed: {
            getWlanState:function () {
                if(this.wlanState){
                    return true;
                }else{
                    return false;
                }
            },
            formSetinfo:function () {
                return {
                    apname: '',
                    ssid2: '',
                    authpwd: 'admin',
                    changePasswd: '',
                    ipaddr: '',
                    gateway: '',
                    dns: '',
                    country2g:"CN",
                    country5g:"CN",
                    security2: '',
                    securityMode2: '0',
                    hidessid:true,
                    wifi_quarantine:false,
                    maxusernumber:'32',
                    vlanid:'0',
//                    wlanset:'3',
                    band2:'9',
                    channel2: '0',
                    band_width2:'0',
                    tx_power2: '100',
                    beacon2g:'100',
                    band5:'14',
//                    ssid5: '',
                    security5: '',
//                    securityMode5: '',
                    channel5: '0',
                    band_width5:'2',
                    tx_power5: '100',
                    beacon5g:'100',
                    other:[]
                };
            },
            ruleSetinfo:function(){
                var _this = this;
                return {
                    apname: [{ validator: function(r, v, f) {
                        if (v == '') {
                            f(_this.$t('central.msg4'));
                        }
                        if (v.length>32) {
                            f(_this.$t('central.msg6'));
                        }
                        f();
                    },
                        trigger: 'blur'
                    }],
                    ssid2: [{ validator: function(r, v, f) {
                        if (v == '') {
                            f(_this.$t('central.msg7'));
                        }
                        f();
                    },
                        trigger: 'blur'
                    }],
                    authpwd: [{ validator: function(r, v, f) {
                        if (v == '') {
                            f(_this.$t('central.msg2'));
                        }
                        f();
                    },
                        trigger: 'blur'
                    }],
                    ipaddr:[
                        { validator:function(r, v, f) {
                            var _s = cs.ip(v);
                            if(0 == _s) {
                                f(_this.$t('central.ipaddr')+_this.$t('central.msg10'));
                            }else if(1 == _s) {
                                f(_this.$t('central.ipaddr')+_this.$t('central.msg14'));
                            }else if(2 == _s) {
                                f(_this.$t('central.ipaddr')+_this.$t('central.msg11'));
                            }else if(3 == _s) {
                                f(_this.$t('central.ipaddr')+_this.$t('central.msg12'));
                            }else if(4 == _s) {
                                f(_this.$t('central.ipaddr')+_this.$t('central.msg13'));
                            }else{
                                f();
                            }
                        },trigger: 'blur' }
                    ],
                    gateway:[
                        { validator:function(r, v, f) {
                            var _s = cs.ip(v);
                            if(0 == _s) {
                                f(_this.$t('central.default_gateway')+_this.$t('central.msg10'));
                            }else if(1 == _s) {
                                f(_this.$t('central.default_gateway')+_this.$t('central.msg14'));
                            }else if(2 == _s) {
                                f(_this.$t('central.default_gateway')+_this.$t('central.msg11'));
                            }else if(3 == _s) {
                                f(_this.$t('central.default_gateway')+_this.$t('central.msg12'));
                            }else if(4 == _s) {
                                f(_this.$t('central.default_gateway')+_this.$t('central.msg13'));
                            }else{
                                if(
                                        _this.formSetinfo.gateway.split('.')[0] != _this.formSetinfo.ipaddr.split('.')[0]
                                        || _this.formSetinfo.gateway.split('.')[1] != _this.formSetinfo.ipaddr.split('.')[1]
                                        || _this.formSetinfo.gateway.split('.')[2] != _this.formSetinfo.ipaddr.split('.')[2]
                                ){
                                    f(_this.$t('central.msg6'));
                                }
                                if(_this.formSetinfo.gateway == _this.formSetinfo.ipaddr){
                                    f(_this.$t('central.msg7'));
                                }
                                f();
                            }
                        },trigger: 'blur' }
                    ],
                    dns: [
                        { validator:function(r, v, f) {
                            var _s = cs.ip(v);
                            if(0 == _s) {
                                f('DNS'+_this.$t('central.msg10'));
                            }else if(1 == _s) {
                                f('DNS'+_this.$t('central.msg14'));
                            }else if(2 == _s) {
                                f('DNS'+_this.$t('central.msg11'));
                            }else if(3 == _s) {
                                f('DNS'+_this.$t('central.msg12'));
                            }else if(4 == _s) {
                                f('DNS'+_this.$t('central.msg13'));
                            }else{
                                f();
                            }
                        },trigger: 'blur' }
                    ]
                }
            },
            centralColumns: function() {
                var _this = this;
                let columns = [];
                columns.push({
                    type: 'expand',
                    width: 30,
                    render: function(h, params) {
                        if(!(params.row.apstate & (1<<8)) ){
                            return h('Row',[]);
                        }else{
                            var aptype = '2.4G';
                            if('1' == params.row.aptype){
                                aptype = '2.4G';
                            }else if('2' == params.row.aptype){
                                aptype = '5G';
                            }else{
                                aptype = '2.4G+5G';
                            }
                            var uptime = cs.formatDate(params.row.uptime,'yyyy-MM-dd hh:mm:ss');
                            return h('Row',[
                                h('Col',{props:{span:6}},[h('p',_this.$t('central.ipaddr') + ': ' + params.row.ipaddr )]),
                                h('Col',{props:{span:6}},[h('p',_this.$t('central.netmask') + ': '+ params.row.netmask )]),
                                h('Col',{props:{span:6}},[h('p',_this.$t('central.default_gateway') + ': ' + params.row.gateway )]),
                                h('Col',{props:{span:6}},[h('p','NDS: '+ params.row.pridns )]),
                                h('Col',{props:{span:24}},[h('br')]),
                                h('Col',{props:{span:6}},[h('p',_this.$t('central.product_mode') + ': '+ params.row.model )]),
                                h('Col',{props:{span:6}},[h('p',_this.$t('central.firmware_version') + ': ' + params.row.softver + '.' + params.row.svnnum )]),
                                h('Col',{props:{span:6}},[h('p',_this.$t('central.publish_time') + ': '+ params.row.builddate )]),
                                h('Col',{props:{span:6}},[h('p',_this.$t('central.online_time') + ': '+ uptime )]),
                                h('Col',{props:{span:24}},[h('br')]),
                                h('Col',{props:{span:6}},[h('p',_this.$t('central.ap_type') + ': '+ aptype )]),
                                h('Col',{props:{span:6}},[h('p',_this.$t('central.username') + ': ' + params.row.username )]),
                                h('Col',{props:{span:6}},[h('p',_this.$t('central.password') + ': '+ params.row.password )]),
                                h('Col',{props:{span:6}},[h('p',_this.$t('central.heartbeat') + ': '+ params.row.hftimes )])
                            ]);
                        }

                    }
                },{
                    type: 'selection',
                    key: 'id',
                    width: "60"
                }
                );
                if(_this.ledStatus){
                    columns.push({
                        title: this.$t('central.letctl'),
                        key: 'id',
                        width: "80",
                        align:"center",
                        render: function(h, params) {
                            console.log(params);
                            console.log(_this.ledStateInfo);
                            _this.ledStateInfo[params.index].color = _this.ledStateInfo[params.index].state == '2'? "#f50" : "#000";
                            return  h('Icon', {
                                style:{
                                    cursor: 'pointer',
                                    color: _this.ledStateInfo[params.index].color
                                },
                                props: {
                                    type: "ios-lightbulb-outline"
                                },
                                nativeOn: {
                                    click: function () {
                                        var data = {};
                                        data.id = params.row.id;


                                        if('2' == _this.ledStateInfo[params.index].state){
                                            _this.ledStateInfo[params.index].state = '1';
                                            _this.ledStateInfo[params.index].color = '#000';
                                            data.ledState = '1';
                                        }else{
                                            _this.ledStateInfo[params.index].state = '2';
                                            _this.ledStateInfo[params.index].color = '#f50';
                                            data.ledState = '2';
                                        }
                                        console.log(_this.ledStateInfo[params.index]);

                                        var postVar ={"action":"setApLedState","data":data};
                                        uiPost.setApLedState(postVar,function(data){
                                            console.log(data);
                                            if (9999 == data.rescode){
                                                cs.loginOut();
                                            }
                                            if (0 == data.rescode) {
                                                _this.$Message.success({content: _this.$t('central.set_success'), onClose: function () {
                                                    location.href = location.href;
                                                }
                                                });
                                            } else {
                                                _this.$Message.error(_this.$t('central.modify_fail')+_this.$t('errorcode.'+data.rescode));
                                            }
                                        });
                                    }
                                }
                            });
                        }
                    })
                }
                columns.push({
                    title: this.$t('central.apname'),
                    key: 'apname',
                    sortable: true,
                    render: function(h, params) {
                        var name = _this.$t('central.unknown');
                        if (params.row.apname != '' && null != params.row.apname) {
                            name = params.row.apname;
                        }
                        if(!(params.row.apstate & (1<<8)) ){
                            if(name == _this.$t('central.unknown')){
                                return h('Input', {
                                    props: {
                                        disabled:"disabled",
                                        placeholder :name
                                    }
                                });
                            }else{
                                return h('Input', {
                                    props: {
                                        disabled:"disabled",
                                        value :name
                                    }
                                });
                            }
                        }else{
                            if(name == _this.$t('central.unknown')){
                                return h('Input', {
                                    props: {
                                        placeholder :name
                                    },
                                    on:{
                                        'on-change':function (e) {
                                            _this.apname[params.index] = e.target.value;
                                        }
                                    }
                                });
                            }else{
                                return h('Input', {
                                    props: {
                                        placeholder :_this.apname[params.index],
                                        value :_this.apname[params.index]
                                    },
                                    on:{
                                        'on-change':function (e) {
                                            _this.apname[params.index] = e.target.value;
                                        }
                                    }
                                });
                            }
                        }
                    }
                }, {
                    title: this.$t('central.macaddr'),
                    key: 'apmac',
                    sortable: true
                },{
                    title: this.$t('central.ipaddr'),
                    key: 'ipaddr',
                    sortable: true,
                    render: function(h, params) {
                        return h('a', {
                            attrs: {
                                href: 'http://' + params.row.ipaddr,
                                target: '_blank'
                            },
                            domProps: {
                                innerHTML: params.row.ipaddr
                            }
                        });
                    }
                }, {
                    title: this.$t('central.device_status'),
                    key: 'apstate',
                    sortable: true,
                    render: function(h, params) {
                        var apState = '';
                        if(params.row.apstate == 0X1FF) {
                            apState = _this.$t('central.user_online');
                        }else {
                            if(!(params.row.apstate & (1<<8)) ) {
                                apState = _this.$t('central.no_same_segment');
                            }else if(!(params.row.apstate & (1<<7) )) {
                                apState = _this.$t('central.no_authority');
                            }else if(params.row.hftimes<7) {
                                apState = _this.$t('central.configuration');
                            }else {
                                apState = _this.$t('central.offline');
                            }
                        }
                        return h('div',apState);
                    }
                },
                {
                    title: this.$t('central.operation'),
                    key: 'operation',
                    align: 'center',
                    render: function(h, params) {
                        if(!(params.row.apstate & (1<<8)) ){
                            return [
                                h('Button', {
                                    props: {
                                        type: 'primary',
                                        size: 'small'
                                    },
                                    on: {
                                        click:function () {
                                            var data = {};
                                            data.apmac = params.row.apmac;
                                            var postVar ={"action":"setApIp","data":data};
                                            uiPost.setApIp(postVar);
                                            var time = 12;
                                            _this.$Modal.success({
                                                loading:true,
                                                render: function(h) {
                                                    return h('div',[
                                                        _this.$t('common.loading'),
                                                        h('Progress',{
                                                            attrs:{ percent:_this.percent }
                                                        })
                                                    ])
                                                }
                                            });
                                            var percentTimer = setInterval(function(){
                                                if (_this.percent>=100) {
                                                    clearInterval(percentTimer);
                                                    location.href = location.href;
                                                }
                                                _this.percent++;
                                            },cs.getTimer(time));
                                        }
                                    }
                                }, _this.$t('central.unified_change_ip'))
                            ]
                        }else{
                            return [
                                h('Button',{
                                            props: {
                                                type: 'primary',
                                                size: 'small'
                                            },
                                            on: {
                                                click:function () {
                                                    var newapname = _this.apname[params.index];
                                                    var apname = params.row.apname;
                                                    console.log(params);

                                                    if(!newapname ){
                                                        _this.$Message.error(_this.$t('central.msg8'));
                                                        return false;
                                                    }
                                                    if (newapname && apname == newapname) {
                                                        _this.$Message.error(_this.$t('central.msg9'));
                                                        return false;
                                                    }
                                                    var data = {};
                                                    data.apid = params.row.id;
                                                    data.apname = newapname;
                                                    var postVar = {"action":"setApName","data":data};
                                                    uiPost.setApName(postVar,function(data) {
                                                        if (9999 == data.rescode){
                                                            cs.loginOut();
                                                        }
                                                        if (0 == data.rescode) {
                                                            _this.$Message.success({content: _this.$t("central.modify_success"), onClose: function () {
                                                                location.href = location.href;
                                                            }
                                                            });
                                                        } else {
                                                            _this.$Message.error(_this.$t("central.modify_fail")+_this.$t('errorcode.'+data.rescode));
                                                        }

                                                    });
                                                }
                                            }
                                        }, _this.$t("central.submit")
                                )]
                        }
                    }
                });
                return columns;
            }
        },
        created: function() {
            var _this = this;
            var data = {};
            data.type = "scan";
            var postVar = {"action":"scanAp","data":data};
            uiPost.scanAp(postVar,function(data){
                if (9999 == data.rescode){
                    cs.loginOut();
                }
                _this.centralData = data.data;
                _this.apscanLoading = false;
                for(var x in data.data){
                    if('2' == data.data[x].ledstate){
                        _this.ledStatus = true;
                        break;
                    }
                }
                for(var i in data.data){
                    _this.apname[i] = data.data[i].apname;
                    _this.ledStateInfo[i] = [];
                    if('2' == data.data[i].ledstate){
                        _this.ledStateInfo[i].state = "2";
                        _this.ledStateInfo[i].color = "#f50";
                    }else{
                        _this.ledStateInfo[i].state = "1";
                        _this.ledStateInfo[i].color = "#000";
                    }
                }
            });
        },
        watch:{
            wlanset:function () {
                console.log(this.wlanset);
            },
            securityMode2:function () {
                if(this.securityMode2){
                    this.formSetinfo.securityMode2 = '1';
                }else{
                    this.formSetinfo.securityMode2 = '0'
                }
            },
            band_width5:function () {
                var _this = this;
                _this.formSetinfo.band_width5 = _this.band_width5;
                if('0' == _this.band_width5 && '2' != _this.band5){
                    _this.channelsStatus165 = true;
                }else{
                    _this.channelsStatus165 = false;
                }
            },
            band5:function () {
                var _this = this;
                _this.formSetinfo.band5 = _this.band5;
                if('0' == _this.band_width5 && '2' != _this.band5){
                    _this.channelsStatus165 = true;
                }else{
                    _this.channelsStatus165 = false;
                }
            }
        },
        methods: {
            init: function() {
                var _this = this;
                var data = {};
                data.type = "exec";
                var postData = {"action":"scanAp","data":data};
                uiPost.scanAp(postData,function(data){
                    console.log(data);
                    if (9999 == data.rescode){
                        cs.loginOut();
                    }

                    var wtime = 10;
                    _this.percent = 0;
                    var percentTimer = setInterval(function(){
                        if (_this.percent>=100) {
                            clearInterval(percentTimer);
                            var data = {};
                            data.type = "scan";
                            var postVar = {"action":"scanAp","data":data};
                            uiPost.scanAp(postVar,function(data){
                                _this.centralData = data.data;
                                _this.apscanLoading = false;
                            });
                        }
                        _this.percent++;
                    },cs.getTimer(wtime));
                });
            },
            ok:function () {
                this.restoreClick();
            },
            cancel:function () {
                var _this = this;
                _this.showModel = false;
            },
            modifyApIp:function (data) {
                var postVar ={"action":"setApIp","data":data};
                uiPost.setApIp(postVar);
                var time = 12;
                _this.$Modal.success({
                    loading:true,
                    render: function(h) {
                        return h('div',[
                            _this.$t('common.loading'),
                            h('Progress',{
                                attrs:{ percent:_this.percent }
                            })
                        ])
                    }
                });
                var percentTimer = setInterval(function(){
                    if (_this.percent>=100) {
                        clearInterval(percentTimer);
                        location.href = location.href;
                    }
                    _this.percent++;
                },cs.getTimer(time));
            },
            apscanClick: function(){
                var _this = this;
                _this.apscanLoading = true;
                _this.init();
            },
            setinfoClick: function(){
                var _this = this;
                var temp = this.selectData;
                if (temp.length <= 0) {
                    this.$Message.error(this.$t('central.msg1'));
                    return false;
                }
                if (temp.length == 1) {
                    this.formSetinfo.apname    = temp[0].apname;
                    var data = {};
                    data.apid = temp[0].id;
                    var postVar = {"action" : "getApStatusConfig","data":data};

                    uiPost.getApStatusConfig(postVar,function(data){
                        if (9999 == data.rescode){
                            cs.loginOut();
                        }
                        if (0 == data.rescode) {
                            data = data.data;
                            if(data.WLAN_STATUS){
                                _this.formSetinfo.ssid2    = data.WLAN_STATUS.ssid;

                                if('0' == data.WLAN_STATUS.encryption){
                                    _this.formSetinfo.securityMode2 = '0';
                                    _this.securityMode2 = false;
                                }else{
                                    _this.formSetinfo.securityMode2 = '1';
                                    _this.securityMode2 = true;
                                }
                                _this.formSetinfo.security2    = data.WLAN_STATUS.passphrase;
                                if('0' == data.WLAN_STATUS.hide){
                                    _this.formSetinfo.hidessid = true;
                                }else{
                                    _this.formSetinfo.hidessid = false;
                                }
                                if('0' == data.WLAN_STATUS.isolate){
                                    _this.formSetinfo.wifi_quarantine = false;
                                }else{
                                    _this.formSetinfo.wifi_quarantine = true;
                                }
                                _this.formSetinfo.maxusernumber    = data.WLAN_STATUS.stanum;
//                                _this.formSetinfo.vlanid    = data.WLAN_STATUS.vlanid;
                            }/*else{
                                _this.formSetinfo.ssid2    = '';
                                _this.formSetinfo.securityMode2    = '0';
                                _this.formSetinfo.security2    = '';
                                _this.formSetinfo.hidessid    = false;
                                _this.formSetinfo.wifi_quarantine    = false;
                                _this.formSetinfo.maxusernumber    = '';
                                _this.formSetinfo.vlanid    = '';
                            }*/

                            if(data.WIFI0_STATUS){
//                            _this.formSetinfo.wlanset    = data.WIFI0_STATUS.vlanid;
                                _this.formSetinfo.band2    = data.WIFI0_STATUS.wirelessmode;
                                _this.formSetinfo.country2g    = data.WIFI0_STATUS.country;
                                _this.formSetinfo.channel2    = data.WIFI0_STATUS.channel;
                                _this.formSetinfo.band_width2    = data.WIFI0_STATUS.htmode;
                                _this.formSetinfo.tx_power2    = data.WIFI0_STATUS.txpower;
                            }/*else{
//                            _this.formSetinfo.wlanset    = '3';
                                _this.formSetinfo.band2    = '';
                                _this.formSetinfo.country2g    = 'CN';
                                _this.formSetinfo.channel2    = '';
                                _this.formSetinfo.band_width2    = '';
                                _this.formSetinfo.tx_power2    = '';
                            }*/

                            if(data.WIFI1_STATUS){
                                _this.formSetinfo.band5    = data.WIFI1_STATUS.wirelessmode;
//                            _this.formSetinfo.wlanset    = data.WIFI1_STATUS.vlanid;
                                _this.formSetinfo.country5g    = data.WIFI1_STATUS.country;
                                _this.formSetinfo.channel5    = data.WIFI1_STATUS.channel;
                                _this.formSetinfo.band_width5    = data.WIFI1_STATUS.htmode;
                                _this.formSetinfo.tx_power5    = data.WIFI1_STATUS.txpower;
                            }/*else{
                                _this.formSetinfo.band5    = '';
                                _this.formSetinfo.country5g    = 'CN';
                                _this.formSetinfo.channel5    = '';
                                _this.formSetinfo.band_width5    = '';
                                _this.formSetinfo.tx_power5    = '';
                            }*/

                            if('1' == temp[0].aptype){
                                _this.wlanset    = '1';
                                _this.wlanState = true;
                            }else if('2' == temp[0].aptype){
                                _this.wlanset    = '2';
                                _this.wlanState = true;
                            }else{
                                _this.wlanset    = '3';
                                _this.wlanState = false;
                            }

                        }

                    });

                    this.multipleHide = true;
                }else{
                    _this.wlanState = false;
                    _this.formSetinfo.apname    = '';
                    _this.formSetinfo.ssid2    = '';
                    _this.formSetinfo.securityMode2    = '0';
                    _this.securityMode2 = false;
                    _this.formSetinfo.security2    = '';
                    _this.formSetinfo.hidessid    = false;
                    _this.formSetinfo.wifi_quarantine    = false;
                    _this.formSetinfo.maxusernumber    = '32';
                    _this.formSetinfo.vlanid    = '0';
                    _this.wlanset    = '3';

                    _this.formSetinfo.band2    = '9';
                    _this.formSetinfo.country2g    = 'CN';
                    _this.formSetinfo.channel2    = '0';
                    _this.formSetinfo.band_width2    = '0';
                    _this.formSetinfo.tx_power2    = '100';

                    _this.formSetinfo.band5    = '14';
                    _this.formSetinfo.country2g    = 'CN';
                    _this.formSetinfo.channel5    = '0';
                    _this.formSetinfo.band_width5    = '2';
                    _this.formSetinfo.tx_power5    = '100';

                    this.multipleHide = true;
//                    for(var i in this.formSetinfo)
//                    {
//                        this.formSetinfo[i] = '';
//                    }
                }
                this.setinfo = true;
            },
            centralTable: function(selection){
                this.selectData = selection;
            },
            setinfoOk: function(){
                var _this = this;
                var temp = this.selectData;


                var idArr = [];
                var data = {};
                for(var i in temp){
                    idArr[i] = temp[i].id
                }

                data.apid = idArr.join(',');
                data.apname = _this.formSetinfo.apname;

                var res = cs.ssid(_this.formSetinfo.ssid2);
                if(0 == res){
                    _this.$Message.error(_this.$t('central.msg10'));
                    return false;
                }else if(99 != res){
                    _this.$Message.error(_this.$t('central.msg11'));
                    return false;
                }
                data.ssid = _this.formSetinfo.ssid2;
                data.encryption = _this.formSetinfo.securityMode2;
                if('1' == _this.formSetinfo.securityMode2){
                    var res = cs.string(_this.formSetinfo.security2);
                    if(99 != res || _this.formSetinfo.security2.length < 8 || _this.formSetinfo.security2.length > 63){
                        _this.$Message.error(_this.$t('central.msg12'));
                        return false;
                    }
                    data.wlanKey = _this.formSetinfo.security2;
                }else{
                    data.wlanKey = '';
                }

                if(true == _this.formSetinfo.hidessid){
                    data.hedden = '0';
                }else{
                    data.hedden = '1';
                }
                if(true == _this.formSetinfo.wifi_quarantine){
                    data.noforward = '1';
                }else{
                    data.noforward = '0';
                }

                if(99 != cs.num_range(_this.formSetinfo.maxusernumber,0,64)){
                    _this.$Message.error(_this.$t('central.msg24'));
                    return false;
                }
                data.maxstanum = _this.formSetinfo.maxusernumber;

                if('0' != _this.formSetinfo.vlanid && 4094 != _this.formSetinfo.vlanid && cs.num_range(_this.formSetinfo.vlanid,0,4094) ){
                    _this.$Message.error(_this.$t('central.msg14'));
                    return false;
                }
                data.vlanid = _this.formSetinfo.vlanid;
                data.usefor = _this.wlanset;

                data.wirelessmode2g = _this.formSetinfo.band2;
                data.country2g = _this.formSetinfo.country2g;
                data.channel2g = _this.formSetinfo.channel2;
                data.htbw2g = _this.formSetinfo.band_width2;
                data.txpower2g = _this.formSetinfo.tx_power2;
                data.beacon2g = _this.formSetinfo.beacon2g;

                data.wirelessmode5g = _this.formSetinfo.band5;
                data.country5g = _this.formSetinfo.country5g;
                data.channel5g = _this.formSetinfo.channel5;
                data.htbw5g = _this.formSetinfo.band_width5;
                data.txpower5g = _this.formSetinfo.tx_power5;
                data.beacon5g = _this.formSetinfo.beacon2g;

                var postData = { "action": "setQuick","data":data };

                uiPost.setQuick(postData,function(data){
                    _this.$Message.success({content: _this.$t('central.set_success'), onClose: function () {
                        location.href = location.href;
                    }
                    });
                });
            },
            letctlClick: function(){
                var temp = this.selectData;
                if (temp.length <= 0) {
                    this.$Message.error(this.$t('central.msg1'));
                    return false;
                }
                this.letctl = true;
            },
            letctlOk: function(index){
                var _this = this;
                var temp = this.selectData;

                if('2' == index){
                    _this.ledStatus = true;
                }else{
                    _this.ledStatus = false;
                }

                var idArr = [];
                var data = {};
                for(var i in temp){
                    idArr[i] = temp[i].id
                }

                data.id = idArr.join(',');
                data.ledState = String(index);

                var postVar ={"action":"setApLedState","data":data};
                uiPost.setApLedState(postVar,function(data){
                    _this.letctl = false;
                    _this.$Message.success({content: _this.$t('central.set_success'), onClose: function () {
                        location.href = location.href;
                    }
                    });
                });


                /*var postVar ={"topicurl":"setting/setApLedState"};
                 postVar.Ledstate = index + '';
                 postVar.Action = 'setledState';

                 postVar.APMACLIST = [];
                 postVar.APIPLIST = [];
                 var selectData = this.selectData;
                 for(var i=0; i<selectData.length; i++)
                 {
                 postVar.APMACLIST.push(selectData[i].apMac);
                 postVar.APIPLIST.push(selectData[i].ipaddr);
                 }

                 uiPost.QuickSetting(postVar,function(){
                 // location.href = location.href;
                 _this.$Message.success(_this.$t('central.set_success'));
                 _this.letctl = false;
                 });*/
            },
            rebootClick: function(){
                var _this = this;
                var temp = this.selectData;
                if (temp.length <= 0) {
                    this.$Message.error(this.$t('central.msg1'));
                    return false;
                }

                var apid = [];
                var data = {};
                for(var i=0;i<temp.length;i++){
                    apid[i] = temp[i].id;
                }
                data.id = apid.join(',');

                var postVar ={"action":"setApReboot","data":data};
                uiPost.setApReboot(postVar,function(data){
                    // location.href = location.href;
                    _this.$Message.success(_this.$t('central.set_success'));
                    _this.reboot = false;
                });


            },
            timingRebootClick: function(status){
                var _this = this;
                if (status) {
                    var getSelection = this.$refs.tableSelect.getSelection();
                    if (getSelection.length>0) {
                        /*全选*/
                        var tmpData = [];
                        var data = {};
                        for(var i=0; i<getSelection.length; i++){
                            if( ( getSelection[i].apstate!="511" ) & !(getSelection[i].apstate & (1<<8)) ) {
                                tmpData[i] = getSelection[i].apmac;
                            }
                        }
                        tmpData['apmac'] = tmpData.join(',');
                        if('' == tmpData['apmac'].length) {
                            _this.$Message.error(_this.$t('central.msg15'));
                            return;
                        }
                        data.apmac = tmpData['apmac'];
                        console.log('---------------setApIp----------------');
                        var postVar ={"action":"setApIp","data":data};
                        uiPost.setApIp(postVar);
                        var time = 12;
                        _this.$Modal.success({
                            loading:true,
                            render: function(h) {
                                return h('div',[
                                    _this.$t('common.loading'),
                                    h('Progress',{
                                        attrs:{ percent:_this.percent }
                                    })
                                ])
                            }
                        });
                        var percentTimer = setInterval(function(){
                            if (_this.percent>=100) {
                                clearInterval(percentTimer);
                                location.href = location.href;
                            }
                            _this.percent++;
                        },cs.getTimer(time));
                    }else{
                        _this.$Message.error(_this.$t('central.msg16'));
                    }
                }else{
                    _this.$refs.tableSelect.selectAll(status);
                }
            },
            timingRebootOk: function(){
                var _this = this;
                if (this.letctlAuthpwd == '') {
                    this.$Message.error(this.$t('central.msg2'));
                    return false;
                }
                if (this.timingRebootSelect == '-1') {
                    this.$Message.error(this.$t('central.msg3'));
                    return false;
                }

                var postVar ={"topicurl":"setting/QuickSetting"};
                var postData = {"Action" : "QuickSetting"};
                postData.AuthPassword = this.letctlAuthpwd;
                postData.SchdReboot = this.timingRebootSelect;


                postVar.Action = 'QuickSetting';

                postVar.APMACLIST = [];
                postVar.APIPLIST = [];
                postVar.NETLIST = [];
                var selectData = this.selectData;
                for(var i=0; i<selectData.length; i++)
                {
                    postVar.APMACLIST.push(selectData[i].apMac);
                    postVar.APIPLIST.push(selectData[i].ipaddr);
                    postVar.NETLIST.push(selectData[i].sameNetwork);
                }

                postVar.postData = postData;

                uiPost.QuickSetting(postVar,function(){
                    // location.href = location.href;
                    _this.$Message.success(_this.$t('central.set_success'));
                    _this.timingReboot = false;
                });
            },
            restoreClick: function(){
                var _this = this ;
                var temp = this.selectData;
                if (temp.length <= 0) {
                    this.$Message.error(this.$t('central.msg1'));
                    return false;
                }
                var data = [];
                for(var i=0;i<temp.length;i++){
                    data[i] = temp[i].id;
                }

                var postVar ={"action":"setApRestore","data":data};
                uiPost.setApRestore(postVar,function(data){
                    // location.href = location.href;
                    _this.$Message.success(_this.$t('central.set_success'));
                    _this.reboot = false;
                });
            },
            restoreOk: function(){
                var _this = this;
                var postVar ={"topicurl":"setting/QuickSetting"};
                postVar.Action = 'LoadDefSettings';

                postVar.APMACLIST = [];
                postVar.APIPLIST = [];
                var selectData = this.selectData;
                for(var i=0; i<selectData.length; i++)
                {
                    postVar.APMACLIST.push(selectData[i].apMac);
                    postVar.APIPLIST.push(selectData[i].ipaddr);
                }

                uiPost.QuickSetting(postVar,function(){
                    // location.href = location.href;
                    _this.$Message.success(_this.$t('central.set_success'));
                    _this.restore = false;
                });
            },
            uploadClick: function(){
                var _this = this;
                var data =[];
                var centdata = _this.centralData;
                for(var i in centdata){
                    data[i] = centdata[i].csid;
                }
                var postData = {"action":"getApUpgradeInfo","data":data};
                uiPost.getApUpgradeInfo(postData,function(data){
                    for (var j in data.data){
                        _this.firmData=data.data;
                    }
                });
                this.uploads = true;
            },
            firmwareClick: function(){
                var _this = this;
                var temp = this.selectData;
                if (temp.length <= 0) {
                    this.$Message.error(this.$t('central.msg1'));
                    return false;
                }
                this.firmware = true;

                var data = [];
                for(var i=0;i<temp.length;i++){
                    data[i] = temp[i].id;
                }

                var postVar ={"action":"setApUpgrade","data":data};
                uiPost.setApUpgrade(postVar,function(data){
                    // location.href = location.href;
                    _this.$Message.success(_this.$t('central.set_success'));
                    _this.firmware = false;
                });
            },
            firmwareOk: function(){
                if (this.letctlAuthpwd == '') {
                    this.$Message.error(this.$t('central.msg2'));
                    return false;
                }
            },
            firmwareOk1:function(){
                var _this = this;
                var postVar ={"topicurl":"setting/QuickSetting"};
                postVar.AuthPassword = this.letctlAuthpwd;
                postVar.Action = 'RemoteUpgradeFW';
                postVar.Port = '80';
                postVar.ProxyEnabled = '0';

                postVar.APMACLIST = [];
                postVar.APIPLIST = [];
                postVar.URLLIST = [];
                postVar.MD5LIST = [];
                var selectData = this.selectData;
                for(var i=0; i<selectData.length; i++)
                {
                    postVar.APMACLIST.push(selectData[i].apMac);
                    postVar.APIPLIST.push(selectData[i].ipaddr);
                    postVar.URLLIST.push(selectData[i].fwUrl);
                    postVar.MD5LIST.push(selectData[i].fwMd5);
                }

                uiPost.QuickSetting(postVar,function(){
                    // location.href = location.href;
                    _this.firmware = false;
                });
            },
            handleUpload: function(file) {
                this.upload.file = file;
            },
           /* exceededSize: function() {
                this.$Message.error({content:this.$t('config.msg3'),duration: 5});
            },*/
            formatError: function() {
                this.$Message.error({content:this.$t('central.msg19',[this.upload.format.join('、')]),duration: 5});
            },
            uploadSuccess:function(){
                this.$Message.success({content:this.$t('central.upload_success'),onClose:function(){
                    location.href = location.href;
                }});
            },
		    handleBeforeUpload (file) {
                var _this = this;
                var filename=file.name;
                /*var name2 = filename.split(".");
                var filetype = name2[3];
                console.log(this.upload.format.join('、'));return false;
                if(filetype != this.upload.format.join('、')){
                    this.$Message.error({content:this.$t('central.msg19',[this.upload.format.join('、')]),duration: 5});
                    return false;
                }*/
                var name1 = filename.split("_");
                var csid = name1[1];
                var apdata = _this.centralData;
                if(apdata.length == 0){
                    this.$Message.error({content:this.$t('central.msg17')});
                    return false;
                }
                var k = 0;
                for(var i in apdata){
                    if(apdata[i].csid == csid){
                        k = 1;
                        break;
                    }
                }
                if(k == 0){
                    this.$Message.error({content:this.$t('central.msg17')});
                    return false;
                }else {
                    return true;
                }
            },
            remove (index) {
                this.firmData.splice(index, 1);
            }
        }
    };
</script>
<script src="/newui/static/js/main.js"></script>
</body>
</html>