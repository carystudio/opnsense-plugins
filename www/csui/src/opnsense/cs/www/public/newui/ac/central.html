<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Carystudio</title>
    <link rel="stylesheet" href="/newui/plugin/iview/styles/iview.css">
    <link rel="stylesheet" href="/newui/static/css/style.css">
</head>
<body>
<div id="app"></div>

<script type="text/x-template" id="main">
    <Col class="cs-container" span="20" >
    <slot name="breadcrumb" :breadcrumb="[$t('menu.ac'),$t('menu.central')]"></slot>
    <!-- 这个不能删除，用于面包屑显示 -->
    <div class="cs-content">
        <Row>
            <Col :xs="globalConfig.xs">
            <Card>
                <Alert>
                    {{ $t('central.help') }}
                </Alert>
                <Row>
                    <Col>
                    <Button type="primary" :loading="apscanLoading" @click="apscanClick">{{ $t('central.apscan') }}</Button>
                    <Button type="primary" @click="setinfoClick">{{ $t('central.setinfo') }}</Button>
                    <Button type="primary" @click="letctlClick">{{ $t('central.letctl') }}</Button>
                    <Button type="primary" @click="timingRebootClick(true)">{{ $t('central.unified_change_ip') }}</Button>
                    <Button type="primary" @click="rebootClick">{{ $t('central.reboot') }}</Button>
                    <Button type="primary" @click="restoreClick">{{ $t('central.restore') }}</Button>
                    <Tooltip trigger="hover" placement="top" :disabled="!usbState">
                        <Button type="primary" @click="uploadClick" >{{ $t('central.upload') }}</Button>
                        <div slot="content" style="white-space: normal;"> {{ $t('central.tip1') }} </div>
                    </Tooltip>
                    <Button type="primary" @click="firmwareClick">{{ $t('central.firmware') }}</Button>
                    </Col>
                    <br>
                    <Row>
                        <Col>
                        <Table border ref="tableSelect" :columns="centralColumns" :data="centralData" @on-selection-change="centralTable"></Table>
                        </Col>
                    </Row>
                </Row>
            </Card>
            </Col>
        </Row>
    </div>
    <Modal
            v-model="setinfo"
            :title="$t('central.setinfo')"
            :closable="false"
            :mask-closable="false"
    >
        <Form ref="formSetinfo" :model="formSetinfo" :label-width="120" :rules="ruleSetinfo" label-position="left">
            <FormItem :label="$t('central.apname')" prop="apname" v-if="multipleHide">
                <Input v-model="formSetinfo.apname" ></Input>
            </FormItem>
            <!--<FormItem :label="$t('central.authpwd')" prop="authpwd">-->
                <!--<Input v-model="formSetinfo.authpwd"></Input>-->
            <!--</FormItem>-->
            <!--<FormItem :label="$t('central.change_passwd')">-->
                <!--<Input v-model="formSetinfo.changePasswd" ></Input>-->
            <!--</FormItem>-->
            <!--<FormItem :label="$t('central.ipaddr')" prop="ipaddr" v-if="multipleHide">-->
                <!--<Input v-model="formSetinfo.ipaddr" ></Input>-->
            <!--</FormItem>-->
            <!--<FormItem :label="$t('central.default_gateway')" prop="gateway">-->
                <!--<Input v-model="formSetinfo.gateway" ></Input>-->
            <!--</FormItem>-->
            <!--<FormItem label="DNS" prop="dns">-->
                <!--<Input v-model="formSetinfo.dns" ></Input>-->
            <!--</FormItem>-->
            <FormItem :label="$t('central.ssid',[''])" prop="ssid2">
                <Input v-model="formSetinfo.ssid2" ></Input>
            </FormItem>
            <FormItem :label="$t('central.security',[''])" prop="security2">
                <Input v-model="formSetinfo.security2" :disabled="formSetinfo.securityMode2==0" >
                <Select v-model="formSetinfo.securityMode2" slot="prepend" style="width: 80px">
                    <Option value="0">{{ $t('central.none_security') }}</Option>
                    <Option value="1">{{ $t('central.security_psk') }}</Option>
                </Select>
                </Input>
            </FormItem>
            <FormItem label="广播SSID" prop="hidessid">
                <i-switch v-model="formSetinfo.hidessid" size="large" >
                    <span slot="open">{{ $t('central.apply') }}</span>
                    <span slot="close">{{ $t('central.disable') }}</span>
                </i-switch>
            </FormItem>
            <FormItem label="WiFi隔离" prop="wifi_quarantine">
                <i-switch v-model="formSetinfo.wifi_quarantine" size="large" >
                    <span slot="open">{{ $t('central.apply') }}</span>
                    <span slot="close">{{ $t('central.disable') }}</span>
                </i-switch>
            </FormItem>
            <FormItem label="最大用户数" prop="maxusernumber">    <!--最大用户数-->
                <Input v-model="formSetinfo.maxusernumber"  style="width: 80px"></Input>
                <span>(默认值为: 32)</span>
            </FormItem>
            <FormItem label="Vlan标记" prop="vlanid">    <!--最大用户数-->
                <Input v-model="formSetinfo.vlanid"  style="width: 80px"></Input>
                <span> (范围 0 - 4094,'缺省 0)</span>
            </FormItem>
            <FormItem label="WLAN设置" prop="wlanset">    <!--最大用户数-->
                <Select v-model="formSetinfo.wlanset">
                    <Option value="0">2.4G</Option>
                    <Option value="1">5G</Option>
                </Select>
            </FormItem>
            <FormItem label="2.4G 频段" prop="band2">    <!--最大用户数-->
                <Select v-model="formSetinfo.band2">
                    <Option value="1">2.4 GHz (B)</Option>
                    <Option value="4">2.4 GHz (G)</Option>
                    <Option value="6">2.4 GHz (N)</Option>
                    <Option value="9">2.4 GHz (B+G+N)</Option>
                </Select>
            </FormItem>
            <FormItem :label="$t('central.channels',['2.4G'])" prop="channel2">
                <Select v-model="formSetinfo.channel2">
                    <Option value="-1">{{ $t('central.unmodify') }}</Option>
                    <Option value="0">{{ $t('central.auto_select') }}</Option>
                    <Option v-for="i in 13" :key="i" :value="i">{{ i }}</Option>
                </Select>
            </FormItem>
            <FormItem label="2.4G 频宽" prop="band_width2">    <!--最大用户数-->
                <Select v-model="formSetinfo.band_width2">
                    <Option value="0">20M</Option>
                    <Option value="1">20M/40M</Option>
                </Select>
            </FormItem>
            <FormItem :label="$t('central.tx_powers',['2.4G'])" prop="tx_power2">
                <Select v-model="formSetinfo.tx_power2">
                    <Option v-for="i in txPower" :key="i" :value="i">{{ i!='-1'?i+'%':$t('central.unmodify') }}</Option>
                </Select>
            </FormItem>
            <div v-if="formSetinfo.ssid5 != ''">
                <FormItem label="5G 频段" prop="band5">    <!--最大用户数-->
                    <Select v-model="formSetinfo.band5">
                        <Option value="2">802.11A</Option>
                        <Option value="8">802.11A/N</Option>
                        <Option value="14">802.11A/N/AC</Option>
                    </Select>
                </FormItem>
                <FormItem :label="$t('central.channels',['5G'])" prop="channel5">
                    <Select v-model="formSetinfo.channel5">
                        <Option value="-1">{{ $t('central.unmodify') }}</Option>
                        <Option value="0">{{ $t('central.auto_select') }}</Option>
                        <Option v-for="i in 13" :key="i" :value="i">{{ i }}</Option>
                    </Select>
                </FormItem>
                <FormItem label="5G 频宽" prop="band_width5">    <!--最大用户数-->
                    <Select v-model="formSetinfo.band5">
                        <Option value="0">20M</Option>
                        <Option value="1">20M/40M</Option>
                        <Option value="2">80M</Option>
                    </Select>
                </FormItem>

                <FormItem :label="$t('central.tx_powers',['5G'])" prop="tx_power5">
                    <Select v-model="formSetinfo.tx_power5">
                        <Option v-for="i in txPower" :key="i" :value="i">{{ i!='-1'?i+'%':$t('central.unmodify') }}</Option>
                    </Select>
                </FormItem>
            </div>
        </Form>
        <div slot="footer">
            <Button type="text" @click="setinfo=false">{{ $t('common.cancel') }}</Button>
            <Button type="primary" @click="setinfoOk">{{ $t('common.apply') }}</Button>
        </div>
    </Modal>
    <Modal
            v-model="letctl"
            :title="$t('central.letctl')"
    >
        <Alert>
            {{ $t('central.ledctl_tip') }}
        </Alert>
        <Form :label-width="120" label-position="left">
            <FormItem>
                <Button type="primary" @click="letctlOk(2)">{{ $t('central.open') }}</Button>
                <Button type="primary" @click="letctlOk(1)">{{ $t('central.finish') }}</Button>
            </FormItem>
        </Form>
        <div slot="footer">
        </div>
    </Modal>
    <Modal
            v-model="uploads"
            :title="$t('central.upload')"
    >
        <Form :label-width="120" label-position="left">
            <FormItem :label="$t('central.fwfile')">
                <!-- :max-size="upload.maxSize" -->
                <Upload
                        ref="upload"
                        :before-upload="handleUpload"
                        :action="upload.action"
                        :data="upload.data"
                        :on-exceeded-size="exceededSize"
                        :format="upload.format"
                        :on-format-error="formatError"
                        :on-success="uploadSuccess"
                >
                    <Button icon="ios-cloud-upload-outline">{{ $t('central.select_file')+' & '+$t('central.file_upload')   }}</Button>
                </Upload>
            </FormItem>
        </Form>
        <div slot="footer">
        </div>
    </Modal>
    <!-- 这个不能删除，用于底部显示 -->
    <slot name="footer"></slot>
    </Col>
</script>
<script src="/newui/plugin/vue.js"></script>
<script src="/newui/plugin/vue-i18n.js"></script>
<script src="/newui/plugin/iview/iview.js"></script>
<script src="/newui/plugin/jquery-1.11.3.min.js"></script>
<script src="/newui/plugin/util.js"></script>
<script src="/newui/static/js/language.js"></script>
<script src="/newui/static/js/config.js"></script>
<script src="/newui/static/js/layout.js"></script>
<script src="/newui/static/js/common.js"></script>
<script src="/newui/static/js/topicurl.js"></script>
<script>
    var cs_main = {
        template: "#main",
        data: function() {
            var _this = this;
            return {
                globalConfig: globalConfig,
                applyLoading: false,
                apscanLoading: false,
                multipleHide: true,
                centralData: [],
                usbState:true,
                setinfo:false,
                letctl:false,
                reboot: false,
                timingReboot: false,
                restore: false,
                uploads: false,
                firmware: false,
                txPower:[-1,15,35,50,75,100],
                selectData:[],
                apname:[],
                formSetinfo: {
                    apname: '',
                    ssid2: '',
                    authpwd: 'admin',
                    changePasswd: '',
                    ipaddr: '',
                    gateway: '',
                    dns: '',
                    security2: '',
                    securityMode2: '',
                    channel2: '-1',
                    tx_power2: -1,
                    ssid5: '',
                    security5: '',
                    securityMode5: '',
                    channel5: '-1',
                    tx_power5: -1,
                    other:[]
                },
                letctlAuthpwd:'admin',
                timingRebootSelect:'',
                upload: {
                    file: null,
                    action: '/cgi-bin/uploadFile.cgi',
                    format:[],
                    data:{},
                    maxSize: 1024
                },
                percent: 0
            }
        },
        computed: {
            ruleSetinfo:function(){
                var _this = this;
                return {
                    apname: [{ validator: function(r, v, f) {
                        console.log('----------apname---------');
                        if (v == '') {
                            f(_this.$t('central.msg4'));
                        }
                        if (v.length>32) {
                            f('AP名称长度不能超过32位！');
                        }
                        f();
                    },
                        trigger: 'blur'
                    }],
                    ssid2: [{ validator: function(r, v, f) {
                        if (v == '') {
                            f('SSID不能为空！');
                        }
                        f();
                    },
                        trigger: 'blur'
                    }],
                    authpwd: [{ validator: function(r, v, f) {
                        if (v == '') {
                            f(_this.$t('central.msg2'));
                        }
                        f();
                    },
                        trigger: 'blur'
                    }],
                    ipaddr:[
                        { validator:function(r, v, f) {
                            var _s = cs.ip(v);
                            if(0 == _s) {
                                f(_this.$t('central.ipaddr')+_this.$t('central.msg10'));
                            }else if(1 == _s) {
                                f(_this.$t('central.ipaddr')+_this.$t('central.msg14'));
                            }else if(2 == _s) {
                                f(_this.$t('central.ipaddr')+_this.$t('central.msg11'));
                            }else if(3 == _s) {
                                f(_this.$t('central.ipaddr')+_this.$t('central.msg12'));
                            }else if(4 == _s) {
                                f(_this.$t('central.ipaddr')+_this.$t('central.msg13'));
                            }else{
                                f();
                            }
                        },trigger: 'blur' }
                    ],
                    gateway:[
                        { validator:function(r, v, f) {
                            var _s = cs.ip(v);
                            if(0 == _s) {
                                f(_this.$t('central.default_gateway')+_this.$t('central.msg10'));
                            }else if(1 == _s) {
                                f(_this.$t('central.default_gateway')+_this.$t('central.msg14'));
                            }else if(2 == _s) {
                                f(_this.$t('central.default_gateway')+_this.$t('central.msg11'));
                            }else if(3 == _s) {
                                f(_this.$t('central.default_gateway')+_this.$t('central.msg12'));
                            }else if(4 == _s) {
                                f(_this.$t('central.default_gateway')+_this.$t('central.msg13'));
                            }else{
                                if(
                                        _this.formSetinfo.gateway.split('.')[0] != _this.formSetinfo.ipaddr.split('.')[0]
                                        || _this.formSetinfo.gateway.split('.')[1] != _this.formSetinfo.ipaddr.split('.')[1]
                                        || _this.formSetinfo.gateway.split('.')[2] != _this.formSetinfo.ipaddr.split('.')[2]
                                ){
                                    f(_this.$t('central.msg6'));
                                }
                                if(_this.formSetinfo.gateway == _this.formSetinfo.ipaddr){
                                    f(_this.$t('central.msg7'));
                                }
                                f();
                            }
                        },trigger: 'blur' }
                    ],
                    dns: [
                        { validator:function(r, v, f) {
                            var _s = cs.ip(v);
                            if(0 == _s) {
                                f('DNS'+_this.$t('central.msg10'));
                            }else if(1 == _s) {
                                f('DNS'+_this.$t('central.msg14'));
                            }else if(2 == _s) {
                                f('DNS'+_this.$t('central.msg11'));
                            }else if(3 == _s) {
                                f('DNS'+_this.$t('central.msg12'));
                            }else if(4 == _s) {
                                f('DNS'+_this.$t('central.msg13'));
                            }else{
                                f();
                            }
                        },trigger: 'blur' }
                    ]
                }
            },
            centralColumns: function() {
                var _this = this;
                return [{
                    type: 'expand',
                    width: 30,
                    render: function(h, params) {
                        if(!(params.row.apstate & (1<<8)) ){
                            return h('Row',[]);
                        }else{
                            var aptype = '2.4G';
                            if('1' == params.row.aptype){
                                aptype = '2.4G';
                            }else if('2' == params.row.aptype){
                                aptype = '5G';
                            }else{
                                aptype = '2.4G+5G';
                            }
                            return h('Row',[
                                h('Col',{props:{span:6}},[h('p','IP:'+ params.row.ipaddr )]),
                                h('Col',{props:{span:6}},[h('p','子网掩码：'+ params.row.netmask )]),
                                h('Col',{props:{span:6}},[h('p','默认网关' + params.row.gateway )]),
                                h('Col',{props:{span:6}},[h('p','NDS:'+ params.row.pridns )]),
                                h('Col',{props:{span:24}},[h('br')]),
                                h('Col',{props:{span:6}},[h('p','产品型号：'+ params.row.model )]),
                                h('Col',{props:{span:6}},[h('p','固件版本：' + params.row.softver + '.' + params.row.svnnum )]),
                                h('Col',{props:{span:6}},[h('p','发布时间：'+ params.row.builddate )]),
                                h('Col',{props:{span:6}},[h('p','上线时间：'+ params.row.uptime )]),
                                h('Col',{props:{span:24}},[h('br')]),
                                h('Col',{props:{span:6}},[h('p','AP类型：'+ aptype )]),
                                h('Col',{props:{span:6}},[h('p','用户名：' + params.row.username )]),
                                h('Col',{props:{span:6}},[h('p','密码：'+ params.row.password )]),
                                h('Col',{props:{span:6}},[h('p','心跳失败次数：'+ params.row.hftimes )])
//                            h('Col',{props:{span:8}},[h('p',_this.$t('central.ssid',['2.4G']) +':'+ params.row.ssid2g)]),
//                            h('Col',{props:{span:8}},[h('p',_this.$t('central.security',['2.4G']) +':'+ params.row.wlanKey2g)]),
//                            h('Col',{style:{display:_g5},props:{span:24}},[h('br')]),
//                            h('Col',{style:{display:_g5},props:{span:8}},[h('p',_this.$t('central.ssid',['5G']) +':'+ params.row.ssid5g)]),
//                            h('Col',{style:{display:_g5},props:{span:8}},[h('p',_this.$t('central.security',['5G']) +':'+ params.row.wlanKey5g)])
                            ]);
                        }

                    }
                },{
                    type: 'selection',
                    key: 'id',
                    width: "100",
                    render: function(h, params) {
                        return  h('Icon', {
                            props: {
                                type: "ios-lightbulb",
                            }
                        });
                    }
                }, {
                    title: this.$t('central.apname'),
                    key: 'apname',
                    sortable: true,
                    render: function(h, params) {
                        console.log(params);
                        var name = _this.$t('central.unknown');
                        if (params.row.apname != '' && null != params.row.apname) {
                            name = params.row.apname;
                        }
                        console.log('--------------table---------------');
                        console.log(params.row.apname);
                        if(!(params.row.apstate & (1<<8)) ){
                            if(name == _this.$t('central.unknown')){
                                return h('Input', {
                                    props: {
                                        disabled:"disabled",
                                        placeholder :name
                                    }
                                });
                            }else{
                                return h('Input', {
                                    props: {
                                        disabled:"disabled",
                                        value :name
                                    }
                                });
                            }
                        }else{
                            if(name == _this.$t('central.unknown')){
                                return h('Input', {
                                    props: {
                                        placeholder :name
                                    },
                                    on:{
                                       'on-change':function (e) {
                                            _this.apname[params.index] = e.target.value;
                                       } 
                                    }
                                });
                            }else{
                                return h('Input', {
                                    props: {
                                        placeholder :_this.apname[params.index],
                                        value :_this.apname[params.index]
                                    },
                                    on:{
                                        'on-change':function (e) {
                                            _this.apname[params.index] = e.target.value;
                                        }
                                    }
                                });
                            }
                        }
                    }
                }, {
                    title: this.$t('central.macaddr'),
                    key: 'apmac',
                    sortable: true
                },{
                    title: this.$t('central.ipaddr'),
                    key: 'ipaddr',
                    sortable: true,
                    render: function(h, params) {
                        return h('a', {
                            attrs: {
                                href: 'http://' + params.row.ipaddr,
                                target: '_blank'
                            },
                            domProps: {
                                innerHTML: params.row.ipaddr
                            }
                        });
                    }
                },  /*{
                 title: this.$t('central.clientconn'),
                 key: 'staNum2g',
                 sortable: true,
                 render: function(h, params) {
                 if (params.row.staNum5g != "") {
                 var tmp_num = params.row.staNum2g + "/" + params.row.staNum5g;
                 } else {
                 var tmp_num = params.row.staNum2g;
                 }
                 return h('div', tmp_num);
                 }
                 }, {
                 title: this.$t('central.device_info'),
                 key: 'softModel',
                 sortable: true,
                 }, */{
                    title: this.$t('central.device_status'),
                    key: 'apstate',
                    sortable: true,
                    render: function(h, params) {
                        var apState = '';
                        if(params.row.apstate == 0X1FF) {
                            apState = _this.$t('central.user_online');
                        }else {
                            if(!(params.row.apstate & (1<<8)) ) {
                                apState = '不在同一网段';
                            }else if(!(params.row.apstate & (1<<7) )) {
                                apState = '没有权限';
                            }else if(params.row.hftimes<7) {
                                apState = '配置中';
                            }else {
                                apState = '离线';
                            }
                        }
                        return h('div',apState);
                    }
                },
                    {
                        title: this.$t('central.operation'),
                        key: 'operation',
                        align: 'center',
                        render: function(h, params) {
                            if(!(params.row.apstate & (1<<8)) ){
                                return [
                                    h('Button', {
                                        props: {
                                            type: 'primary',
                                            size: 'small'
                                        },
                                        on: {
                                            click:function () {
                                                var data = {};
                                                data.apmac = params.row.apmac;
//                                                _this.modifyApIp(data);
                                                var postVar ={"action":"setApIp","data":data};
                                                uiPost.setApIp(postVar);
                                                var time = 12;
                                                _this.$Modal.success({
                                                    loading:true,
                                                    render: function(h) {
                                                        return h('div',[
                                                            _this.$t('common.loading'),
                                                            h('Progress',{
                                                                attrs:{ percent:_this.percent }
                                                            })
                                                        ])
                                                    }
                                                });
                                                var percentTimer = setInterval(function(){
                                                    if (_this.percent>=100) {
                                                        clearInterval(percentTimer);
                                                        location.href = location.href;
                                                    }
                                                    _this.percent++;
                                                },cs.getTimer(time));
                                            }
                                        }
                                    }, '一键修改IP')
                                ]
                            }else{
                                return [
                                    h('Button',{
                                        props: {
                                            type: 'primary',
                                            size: 'small'
                                        },
                                        on: {
                                            click:function () {
                                                console.log('-----------提交--------------');
                                                var newapname = _this.apname[params.index];
                                                var apname = params.row.apname;
                                                console.log(params);

                                                if(!newapname ){
                                                    _this.$Message.error('设备名称不能为空');
                                                    return false;
                                                }
                                                if (newapname && apname == newapname) {
                                                    _this.$Message.error("修改名称和原名称相同！");
                                                    return false;
                                                }
                                                console.log('-------end--------');
                                                var data = {};
                                                data.apid = params.row.id;
                                                data.apname = newapname;
                                                var postVar = {"action":"setApName","data":data};
                                                uiPost.setApName(postVar,function(data) {
                                                    if (9999 == data.rescode){
                                                        cs.loginOut();
                                                    }
                                                    if (0 == data.rescode) {
                                                        _this.$Message.success({content: '修改成功', onClose: function () {
                                                                location.href = location.href;
                                                            }
                                                        });
                                                    } else {
                                                        _this.$Message.error('修改失败！'+_this.$t('errorcode.'+data.rescode));
                                                    }

                                                });
                                            }
                                        }
                                    }, '提交'
                                    )]
                            }

                        }
                    }];
            }
        },
        created: function() {
            var _this = this;
            var data = {};
            data.type = "scan";
            var postVar = {"action":"scanAp","data":data};
            uiPost.scanAp(postVar,function(data){
                console.log(data);
                if (9999 == data.rescode){
                    cs.loginOut();
                }
                _this.centralData = data.data;
                _this.apscanLoading = false;

                for(var i in data.data){
                    _this.apname[i] = data.data[i].apname;
                }
            });
            /*
            uiPost.getUsbState(function(data){
                _this.usbState = data.usbState != 1 ? true : false;
            });*/
        },
        methods: {
            init: function() {
                var _this = this;
                var data = {};
                data.type = "exec";
                var postData = {"action":"scanAp","data":data};
                uiPost.scanAp(postData,function(data){
                    console.log(data);
                    if (9999 == data.rescode){
                        cs.loginOut();
                    }

                    var wtime = 10;
                    _this.percent = 0;
                    var percentTimer = setInterval(function(){
                        if (_this.percent>=100) {
                            clearInterval(percentTimer);
                            var data = {};
                            data.type = "scan";
                            var postVar = {"action":"scanAp","data":data};
                            uiPost.scanAp(postVar,function(data){
                                console.log(data);
                                _this.centralData = data.data;
                                _this.apscanLoading = false;
                            });
                        }
                        _this.percent++;
                    },cs.getTimer(wtime));
                });
            },
            modifyApIp:function (data) {
                console.log('----------modifyApIp--------------');
                console.log(data);
                var postVar ={"action":"setApIp","data":data};
                uiPost.setApIp(postVar);
                var time = 12;
                _this.$Modal.success({
                    loading:true,
                    render: function(h) {
                        return h('div',[
                            _this.$t('common.loading'),
                            h('Progress',{
                                attrs:{ percent:_this.percent }
                            })
                        ])
                    }
                });
                var percentTimer = setInterval(function(){
                    if (_this.percent>=100) {
                        clearInterval(percentTimer);
                        location.href = location.href;
                    }
                    _this.percent++;
                },cs.getTimer(time));
            },
            apscanClick: function(){
                var _this = this;
                _this.apscanLoading = true;
                _this.init();
             },
            /*apscanClick:function() {
                var _this = this;
                uiPost.acScanAp(function (data) {     //扫描
                    _this.$Message.success({content:'Success!',onClose:function(){
                    }});
                })
            },*/
            setinfoClick: function(){
                var temp = this.selectData;
                if (temp.length <= 0) {
                    this.$Message.error(this.$t('central.msg1'));
                    return false;
                }
                if (temp.length == 1) {
                    this.formSetinfo.apname    = temp[0].name;
                    this.formSetinfo.ipaddr    = temp[0].ipaddr;
                    this.formSetinfo.gateway   = temp[0].gateway;
                    this.formSetinfo.dns       = temp[0].dns1;
                    this.formSetinfo.ssid2     = temp[0].ssid2g;
                    this.formSetinfo.security2 = temp[0].wlanKey2g;
                    this.formSetinfo.channel2  = temp[0].channel2g;
                    this.formSetinfo.tx_power2 = temp[0].txPower2g;
                    this.formSetinfo.ssid5     = temp[0].ssid5g;
                    this.formSetinfo.security5 = temp[0].wlanKey5g;
                    this.formSetinfo.channel5  = temp[0].channel5g;
                    this.formSetinfo.tx_power5 = temp[0].txPower5g;
                    this.formSetinfo.other     = temp[0];
                    this.multipleHide = true;
                }else{
                    this.multipleHide = true;
                    for(var i in this.formSetinfo)
                    {
                        this.formSetinfo[i] = '';
                    }
                    this.formSetinfo.ssid5 = ' ';
                }
                this.setinfo = true;
            },
            centralTable: function(selection){
                this.selectData = selection;
            },
            setinfoOk: function(){
                var _this = this;
                var postVar = {};
                var postData = { Action: "QuickSetting" };
                postData.AuthPassword = this.formSetinfo.authpwd;
                if (this.formSetinfo.changePasswd != "") {
                    postData.ModifyPassword = this.formSetinfo.changePasswd;
                }
                postData.Ipaddr = this.formSetinfo.ipaddr;
                postData.Gateway = this.formSetinfo.gateway;
                postData.Dns1 = this.formSetinfo.dns;
                postData.Ssid2g = this.formSetinfo.ssid2;
                postData.WlanKey2g = this.formSetinfo.security2;
                postData.Channel2g = this.formSetinfo.channel2 + '';
                postData.TxPower2g = this.formSetinfo.tx_power2 + '';
                postData.Ssid5g = this.formSetinfo.ssid5;
                postData.WlanKey5g = this.formSetinfo.security5;
                postData.Channel5g = this.formSetinfo.channel5;
                postData.TxPower5g = this.formSetinfo.tx_power5;
                postData.APName = this.formSetinfo.apname;

                postVar.APMACLIST = [];
                postVar.APIPLIST = [];
                postVar.NETLIST = [];
                var selectData = this.selectData;
                for(var i=0; i<selectData.length; i++)
                {
                    postVar.APMACLIST.push(selectData[i].apMac);
                    postVar.APIPLIST.push(selectData[i].ipaddr);
                    postVar.NETLIST.push(selectData[i].sameNetwork);
                }

                postVar.Action = "QuickSetting";
                postVar.postData = postData;

                this.$refs.formSetinfo.validate(function(valid){
                    if (valid) {
                        uiPost.QuickSetting(postVar,function(data){
                            // _this.$Modal.remove();
                            // location.href = location.href;
                            _this.$Message.success(_this.$t('central.set_success'));
                            _this.setinfo = false;
                        });
                    }
                });
            },
            letctlClick: function(){
                var temp = this.selectData;
                if (temp.length <= 0) {
                    this.$Message.error(this.$t('central.msg1'));
                    return false;
                }
                this.letctl = true;
            },
            letctlOk: function(index){
                var _this = this;
                var temp = this.selectData;

                console.log(temp);

                var idArr = [];
                var data = {};
                for(var i in temp){
                    idArr[i] = temp[i].id
                }

                data.id = idArr.join(',');
                data.ledState = String(index);

                var postVar ={"action":"setApLedState","data":data};
                uiPost.setApLedState(postVar,function(data){
                    _this.$Message.success(_this.$t('central.set_success'));
                    _this.letctl = false;
                });


                /*var postVar ={"topicurl":"setting/setApLedState"};
                postVar.Ledstate = index + '';
                postVar.Action = 'setledState';

                postVar.APMACLIST = [];
                postVar.APIPLIST = [];
                var selectData = this.selectData;
                for(var i=0; i<selectData.length; i++)
                {
                    postVar.APMACLIST.push(selectData[i].apMac);
                    postVar.APIPLIST.push(selectData[i].ipaddr);
                }

                uiPost.QuickSetting(postVar,function(){
                    // location.href = location.href;
                    _this.$Message.success(_this.$t('central.set_success'));
                    _this.letctl = false;
                });*/
            },
            rebootClick: function(){
                var _this = this;
                var temp = this.selectData;
                console.log(temp);
                if (temp.length <= 0) {
                    this.$Message.error(this.$t('central.msg1'));
                    return false;
                }

                var apid = [];
                var data = {};
                for(var i=0;i<temp.length;i++){
                    apid[i] = temp[i].id;
                }
                data.id = apid.join(',');
                console.log(data);

                var postVar ={"action":"setApReboot","data":data};
                uiPost.setApReboot(postVar,function(data){
                    // location.href = location.href;
                    _this.$Message.success(_this.$t('central.set_success'));
                    _this.reboot = false;
                });

           
            },
            timingRebootClick: function(status){
                var _this = this;
                if (status) {
                    var getSelection = this.$refs.tableSelect.getSelection();
                    if (getSelection.length>0) {
                        /*全选*/
                       console.log(getSelection);
                        var tmpData = [];
                        var data = {};
                        for(var i=0; i<getSelection.length; i++){
                            if( ( getSelection[i].apstate!="511" ) & !(getSelection[i].apstate & (1<<8)) ) {
                                tmpData[i] = getSelection[i].apmac;
                            }
                        }
                        tmpData['apmac'] = tmpData.join(',');
                        if('' == tmpData['apmac'].length) {
                            _this.$Message.error("请选择不同网络的设备!");
                            return;
                        }
                        data.apmac = tmpData['apmac'];
                        console.log('---------------setApIp----------------');
                        var postVar ={"action":"setApIp","data":data};
                        console.log(postVar);
                        uiPost.setApIp(postVar);
                        var time = 12;
                        _this.$Modal.success({
                            loading:true,
                            render: function(h) {
                                return h('div',[
                                    _this.$t('common.loading'),
                                    h('Progress',{
                                        attrs:{ percent:_this.percent }
                                    })
                                ])
                            }
                        });
                        var percentTimer = setInterval(function(){
                            if (_this.percent>=100) {
                                clearInterval(percentTimer);
                                location.href = location.href;
                            }
                            _this.percent++;
                        },cs.getTimer(time));
                    }else{
                        _this.$Message.error('请选择需要修改的IP');
                    }
                }else{
                    _this.$refs.tableSelect.selectAll(status);
                }
            },
            timingRebootOk: function(){
                var _this = this;
                if (this.letctlAuthpwd == '') {
                    this.$Message.error(this.$t('central.msg2'));
                    return false;
                }
                if (this.timingRebootSelect == '-1') {
                    this.$Message.error(this.$t('central.msg3'));
                    return false;
                }

                var postVar ={"topicurl":"setting/QuickSetting"};
                var postData = {"Action" : "QuickSetting"};
                postData.AuthPassword = this.letctlAuthpwd;
                postData.SchdReboot = this.timingRebootSelect;


                postVar.Action = 'QuickSetting';

                postVar.APMACLIST = [];
                postVar.APIPLIST = [];
                postVar.NETLIST = [];
                var selectData = this.selectData;
                for(var i=0; i<selectData.length; i++)
                {
                    postVar.APMACLIST.push(selectData[i].apMac);
                    postVar.APIPLIST.push(selectData[i].ipaddr);
                    postVar.NETLIST.push(selectData[i].sameNetwork);
                }

                postVar.postData = postData;

                uiPost.QuickSetting(postVar,function(){
                    // location.href = location.href;
                    _this.$Message.success(_this.$t('central.set_success'));
                    _this.timingReboot = false;
                });
            },
            restoreClick: function(){
                var temp = this.selectData;
                if (temp.length <= 0) {
                    this.$Message.error(this.$t('central.msg1'));
                    return false;
                }
                var data = [];
                for(var i=0;i<temp.length;i++){
                    data[i] = temp[i].id;
                }

                var postVar ={"action":"setApRestore","data":data};
                uiPost.setApRestore(postVar,function(data){
                    // location.href = location.href;
                    _this.$Message.success(_this.$t('central.set_success'));
                    _this.reboot = false;
                });
            },
            restoreOk: function(){
                var _this = this;
                var postVar ={"topicurl":"setting/QuickSetting"};
                postVar.Action = 'LoadDefSettings';

                postVar.APMACLIST = [];
                postVar.APIPLIST = [];
                var selectData = this.selectData;
                for(var i=0; i<selectData.length; i++)
                {
                    postVar.APMACLIST.push(selectData[i].apMac);
                    postVar.APIPLIST.push(selectData[i].ipaddr);
                }

                uiPost.QuickSetting(postVar,function(){
                    // location.href = location.href;
                    _this.$Message.success(_this.$t('central.set_success'));
                    _this.restore = false;
                });
            },
            uploadClick: function(){
                this.uploads = true;
            },
            firmwareClick: function(){
                var temp = this.selectData;
                if (temp.length <= 0) {
                    this.$Message.error(this.$t('central.msg1'));
                    return false;
                }
                this.firmware = true;

                var data = [];
                for(var i=0;i<temp.length;i++){
                    data[i] = temp[i].id;
                }

                var postVar ={"action":"setApUpgrade","data":data};
                uiPost.setApUpgrade(postVar,function(data){
                    // location.href = location.href;
                    _this.$Message.success(_this.$t('central.set_success'));
                    _this.firmware = false;
                });
            },
            firmwareOk: function(){
                if (this.letctlAuthpwd == '') {
                    this.$Message.error(this.$t('central.msg2'));
                    return false;
                }
            },
            firmwareOk1:function(){
                var _this = this;
                var postVar ={"topicurl":"setting/QuickSetting"};
                postVar.AuthPassword = this.letctlAuthpwd;
                postVar.Action = 'RemoteUpgradeFW';
                postVar.Port = '80';
                postVar.ProxyEnabled = '0';

                postVar.APMACLIST = [];
                postVar.APIPLIST = [];
                postVar.URLLIST = [];
                postVar.MD5LIST = [];
                var selectData = this.selectData;
                for(var i=0; i<selectData.length; i++)
                {
                    postVar.APMACLIST.push(selectData[i].apMac);
                    postVar.APIPLIST.push(selectData[i].ipaddr);
                    postVar.URLLIST.push(selectData[i].fwUrl);
                    postVar.MD5LIST.push(selectData[i].fwMd5);
                }

                uiPost.QuickSetting(postVar,function(){
                    // location.href = location.href;
                    _this.firmware = false;
                });
            },
            handleUpload: function(file) {
                this.upload.file = file;
            },
            exceededSize: function() {
                this.$Message.error({content:this.$t('config.msg3'),duration: 5});
            },
            formatError: function() {
                this.$Message.error({content:this.$t('config.msg2',[this.upload.format.join('、')]),duration: 5});
            },
            uploadSuccess:function(){

            }
        }
    };
</script>
<script src="/newui/static/js/main.js"></script>
</body>
</html>